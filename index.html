<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Habit Dashboard</title>
  <link rel="stylesheet" href="style.css">

</head>
<body>
<header class="app-header">
  <div class="header-left">
    <a href="index.html">Habit Dashboard</a>
  </div>

  <div class="header-right">
    <span id="userEmail"></span>
    <button id="darkModeToggle">ðŸŒ™ Dark Mode</button>
    <button id="logoutBtn">Log out</button>
  </div>
</header>

<div class="page-actions">
  <a href="input.html" class="btn-secondary">
    + Add Entry
  </a>
</div>


<div class="filter-bar">
  <div>
    <label for="startMonth">Start month:</label>
    <input type="month" id="startMonth">
  </div>
  <div>
    <label for="endMonth">End month:</label>
    <input type="month" id="endMonth">
  </div>
  <div class="filter-buttons">
    <button id="applyFilter">Apply</button>
    <button id="resetFilter">Reset</button>
  </div>
</div>


<section>
  <h2>Ratings Over Time</h2>
  <div class="chart-container">
    <canvas id="ratingsChart"></canvas>
  </div>
</section>

<section>
  <h2>Sleep Chart</h2>
  <div class="chart-container">
    <canvas id="sleepChart"></canvas>
  </div>
</section>

<section>
  <h2>Time Allocation</h2>

  <div class="chart-controls">
    <div class="control-group">
      <span class="control-label">View</span>
      <button class="control-btn active" data-toggle="weekly" data-value="false">
        Daily
      </button>
      <button class="control-btn" data-toggle="weekly" data-value="true">
        Weekly
      </button>
    </div>

    <div class="control-group">
      <span class="control-label">Bars</span>
      <button class="control-btn active" data-toggle="stacked" data-value="false">
        Grouped
      </button>
      <button class="control-btn" data-toggle="stacked" data-value="true">
        Stacked
      </button>
    </div>
  </div>

  <p class="chart-helper">
    Compare how you allocate time between work and personal projects.
  </p>

  <div class="chart-container">
    <canvas id="hoursChart"></canvas>
  </div>
</section>



<section>
  <h2>Habit Chart</h2>
  <div class="chart-container">
    <canvas id="habitChart"></canvas>
  </div>
</section>


<section>
  <h2>Daily Notes</h2>
  <div class="daily-list-container">
    <table class="daily-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Keyword</th>
          <th>Summary</th>
          <th>Overall</th>
        </tr>
      </thead>
      <tbody id="dailyTableBody"></tbody>
    </table>
  </div>
</section>

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Global Supabase client (must be first) -->
<script src="supabaseClient.js"></script>

<!-- Theme (defines savedTheme ONCE) -->
<script src="theme.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Dashboard logic -->
<script src="script.js"></script>

<script>
  document.addEventListener("click", (e) => {
    const btn = e.target.closest(".control-btn");
    if (!btn) return;

    // Ensure shared config exists
    if (typeof window.HOURS_CHART_CONFIG !== "object") {
      console.warn("HOURS_CHART_CONFIG not found on window");
      return;
    }

    const key = btn.dataset.toggle;      // "weekly" or "stacked"
    const value = btn.dataset.value === "true";

    // ðŸ”‘ MUTATE SHARED CONFIG (DO NOT REDECLARE)
    if (key in HOURS_CHART_CONFIG) {
      HOURS_CHART_CONFIG[key] = value;
      console.log(`HOURS_CHART_CONFIG.${key} =`, value);
    } else {
      console.warn(`Unknown HOURS_CHART_CONFIG key: ${key}`);
      return;
    }

    // Update active button styles within this control group only
    const group = btn.parentElement;
    group.querySelectorAll(".control-btn").forEach(b =>
      b.classList.remove("active")
    );
    btn.classList.add("active");

    // Rebuild charts using existing pipeline
    if (typeof buildCharts === "function" && typeof getFilteredData === "function") {
      buildCharts(getFilteredData());
    } else {
      console.warn("buildCharts or getFilteredData not available");
    }
  });
</script>

<script>
  document.addEventListener("click", (e) => {
    const btn = e.target.closest(".control-btn");
    if (!btn) return;

    const key = btn.dataset.toggle;
    const value = btn.dataset.value === "true";

    // Flip existing config flag
    if (window.HOURS_CHART_CONFIG && key in HOURS_CHART_CONFIG) {
      HOURS_CHART_CONFIG[key] = value;
    }

    // Update active states within the group
    btn.parentElement.querySelectorAll(".control-btn")
      .forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    // Rebuild charts using existing pipeline
    if (typeof buildCharts === "function") {
      buildCharts(getFilteredData());
    }
  });
</script>




</body>
</html>

